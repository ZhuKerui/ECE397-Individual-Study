<!DOCTYPE HTML>
{% load static %}
<html>

<head>
	<title>Destroydrop &raquo; Javascripts &raquo; Tree</title>

	<link rel="StyleSheet" href="{% static 'css/dtree.css' %}" type="text/css" />
	<!-- jQuery -->
	<script src="{% static 'js/jquery.min.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/dtree.js' %}"></script>

</head>

<body>

<h2>Input Your Central Keyword</h2>

<div>
	<input type="text" placeholder="Central Keyword" id="central_keyword" />
	<button type="button" id="search_central_keyword" >Search</button>
</div>

<div class="dtree" id="tree_display"></div>


<script>

	objName = 'd';

	d = new dTree(objName);

	node_cnt = 0;

	function add_node(pid, name, link){
		d.add(node_cnt, pid, name, link);
		node_cnt += 1;
		return node_cnt-1;
	}

	function add_folder(pid, name, link){
		id = add_node(pid, name, link);
		add_node(id, 'fake_node');
		return id;
	}

	$('#search_central_keyword').click(function(){
		$.ajax({
			'url':'/init_ck/',
			'data':{
				"central_keyword":$("#central_keyword").val()
			},
			'success' :function(ret){
				$('#tree_display').empty();
				if (ret["status"]){
					d = new dTree(objName);
					add_node(-1, 'Tree Display for "' + ret["central_keyword"] + '"');
					add_folder(0, ret["central_keyword"], 'javascript:void(0);');
					$('#tree_display').append(d.toString());
				} else {
					$('#tree_display').append('<p>The keyword does not exist.</p>');
				}
			}
		});
	});

	function search_topic_similar (id) {

		ai = parseInt(id.split(objName)[1]);

		if (!d.isOpen(ai)){

			tr_threshold = $("#t"+objName+ai+"_th1").val();
			fc_threshold = $("#t"+objName+ai+"_th2").val();
			d.storeThreshold(ai, tr_threshold, fc_threshold);

			$.ajax({
				'url':'/get_tr/',
				'data':{
					"central_keyword":$("#central_keyword").val(),
					"topic_related_threshold":tr_threshold,
					"function_cluster_threshold":fc_threshold,
				},
				'success' :function(ret){
					pid = d.removeNode(ai);
					$('#tree_display').empty();
					if (ret["status"]){
						children = ret["children"];
						for (var child in children){
							add_folder(pid, child, 'javascript:void(0);');
						}
						$('#tree_display').append(d.toString());
					} else {
						$('#tree_display').append('<p>The keyword does not exist.</p>');
					}
				}
			});
		}

		// ids = [];

		// for (var i = 0; i < d.aNodes.length; i++){
		// 	ids.push(d.aNodes[i].id);
		// }

		// console.log(ids);

		d.o(ai);

	}


</script>

</body>

</html>